#include "StdAfx.h"
#include "templetAALang.h"

#ifdef _DEBUG
#define new DEBUG_NEW
#undef THIS_FILE
static char THIS_FILE[] = __FILE__;
#endif

int MyTempletData_0[]={
	0, 0, 4, 4, 0,
	0, 0, 1, 1, 1,
	1, 0, 1, 1, 0,
	2, 0, 1, 1, 0,
	3, 0, 1, 1, 0,
	0, 1, 1, 1, 0,
	1, 1, 1, 1, 0,
	2, 1, 1, 1, 0,
	3, 1, 1, 1, 0,
	0, 2, 1, 1, 0,
	1, 2, 1, 1, 0,
	2, 2, 1, 1, 0,
	3, 2, 1, 1, 0,
	0, 3, 1, 1, 0,
	1, 3, 1, 1, 0,
	2, 3, 1, 1, 0,
	3, 3, 1, 1, 0
};

int MyTempletData_1[]={
	0, 0, 1, 1, 0,
	0, 0, 1, 1, 1
};

int MyTempletData_2[]={
	0, 0, 2, 1, 0x0100,
	0, 0, 1, 1, 1,
	1, 0, 1, 1, 0
};

int MyTempletData_3[]={
	0, 0, 5, 5, 1,
	0, 0, 5, 5, 1,
	4, 4, 1, 1, 0
};

int MyTempletData_4[]={
	0, 0, 2, 2, 0,
	0, 0, 1, 1, 1,
	0, 1, 1, 1, 0,
	1, 0, 1, 1, 0,
	1, 1, 1, 1, 0
};

int MyTempletData_5[]={
	0, 0, 4, 4, 0,
	0, 0, 3, 4, 1,
	3, 0, 1, 1, 0,
	3, 1, 1, 1, 0,
	3, 2, 1, 1, 0,
	3, 3, 1, 1, 0
};

int MyTempletData_6[]={
	0, 0, 3, 3, 0,
	0, 0, 2, 2, 1,
	2, 0, 1, 1, 0,
	2, 1, 1, 1, 0,
	2, 2, 1, 1, 0,
	1, 2, 1, 1, 0,
	0, 2, 1, 1, 0
};

int MyTempletData_7[]={
	0, 0, 4, 4, 0,
	0, 0, 3, 3, 1,
	3, 0, 1, 1, 0,
	3, 1, 1, 1, 0,
	3, 2, 1, 1, 0,
	3, 3, 1, 1, 0,
	2, 3, 1, 1, 0,
	1, 3, 1, 1, 0,
	0, 3, 1, 1, 0
};

int MyTempletData_8[]={
	0, 0, 3, 3, 0,
	0, 0, 1, 1, 1,
	0, 1, 1, 1, 0,
	0, 2, 1, 1, 0,
	1, 0, 1, 1, 0,
	1, 1, 1, 1, 0,
	1, 2, 1, 1, 0,
	2, 0, 1, 1, 0,
	2, 1, 1, 1, 0,
	2, 2, 1, 1, 0
};

int MyTempletData_9[]={
	0, 0, 5, 5, 0,
	0, 0, 4, 4, 1,
	4, 0, 1, 1, 0,
	4, 1, 1, 1, 0,
	4, 2, 1, 1, 0,
	4, 3, 1, 1, 0,
	4, 4, 1, 1, 0,
	3, 4, 1, 1, 0,
	2, 4, 1, 1, 0,
	1, 4, 1, 1, 0,
	0, 4, 1, 1, 0
};

int MyTempletData_10[]={
		0, 0, 5, 5, 0,
		0, 0, 1, 1, 1,
		1, 0, 1, 1, 0,
		2, 0, 1, 1, 0,
		3, 0, 1, 1, 0,
		4, 0, 1, 1, 0,
		0, 1, 1, 1, 0,
		1, 1, 1, 1, 0,
		2, 1, 1, 1, 0,
		3, 1, 1, 1, 0,
		4, 1, 1, 1, 0,
		0, 2, 1, 1, 0,
		1, 2, 1, 1, 0,
		2, 2, 1, 1, 0,
		3, 2, 1, 1, 0,
		4, 2, 1, 1, 0,
		0, 3, 1, 1, 0,
		1, 3, 1, 1, 0,
		2, 3, 1, 1, 0,
		3, 3, 1, 1, 0,
		4, 3, 1, 1, 0,
		0, 4, 1, 1, 0,
		1, 4, 1, 1, 0,
		2, 4, 1, 1, 0,
		3, 4, 1, 1, 0,
		4, 4, 1, 1, 0
};

int MyTempletData_11[]={
		0, 0, 2, 4, 0,
		0, 1, 1, 2, 1,
		1, 1, 1, 2, 0,
};

int MyTempletData_12[]={
		0, 0, 4, 4, 0,
		0, 0, 2, 2, 1,
		2, 0, 2, 2, 0,
		1, 2, 2, 2, 0,		
};

int MyTempletData_13[]={
	0, 0, 4, 4, 0,
		0, 0, 1, 1, 0,
		1, 0, 1, 1, 0,
		2, 0, 1, 1, 0,
		3, 0, 1, 1, 0,
		0, 1, 2, 2, 0,
		2, 1, 2, 2, 0,
		0, 3, 1, 1, 0,
		1, 3, 1, 1, 0,
		2, 3, 1, 1, 0,
		3, 3, 1, 1, 0,
};

int MyTempletData_14[]={
	0, 0, 4, 4, 0,
		0, 0, 2, 2, 1,
		2, 0, 1, 1, 0,
		3, 0, 1, 1, 0,
		2, 1, 1, 1, 0,
		3, 1, 1, 1, 0,
		0, 2, 1, 1, 0,
		1, 2, 1, 1, 0,
		2, 2, 1, 1, 0,
		3, 2, 1, 1, 0,
		0, 3, 1, 1, 0,
		1, 3, 1, 1, 0,
		2, 3, 1, 1, 0,
		3, 3, 1, 1, 0,
};

int MyTempletData_15[]={
	0, 0, 4, 4, 0,
		0, 0, 1, 1, 1,
		1, 0, 1, 1, 0,
		2, 0, 1, 1, 0,
		3, 0, 1, 1, 0,
		0, 1, 1, 1, 0,
		1, 1, 2, 2, 0,
		3, 1, 1, 1, 0,
		0, 2, 1, 1, 0,
		3, 2, 1, 1, 0,
		0, 3, 1, 1, 0,
		1, 3, 1, 1, 0,
		2, 3, 1, 1, 0,
		3, 3, 1, 1, 0,
};


CTempletAALang::CTempletAALang(void)
{
	m_nWindowNumber			= 0;
	m_nScreenIndex			= 1;
	//	m_rectScreen			= AfxGetScreenRect();
	int i=0;for ( i=0; i < 25; i++)
	{
		SetWindowSelected(i,false);
	}
}

CTempletAALang::~CTempletAALang(void)
{
}


void CTempletAALang::SetType(int nType,int nNumber)
{
	m_nWindowNumber = 0;		//预赋值为0
	m_bRepairTemplet=FALSE;

	memset(&m_rectFree, 0, sizeof(RECT));
	m_rectMidWindow.SetRect(0, 0, 0, 0);
	
	switch(nType)
	{
	case 21:
		{
			SetTempletParam(MyTempletData_1, sizeof(MyTempletData_1)/sizeof(int));
			break;
		}
	case 30:
		{
			SetTempletParam(MyTempletData_3, sizeof(MyTempletData_3)/sizeof(int));
			break;
		}
	case 22:
		{
			SetTempletParam(MyTempletData_4, sizeof(MyTempletData_4)/sizeof(int));
			break;
		}
	case 12:
		{
			SetTempletParam(MyTempletData_6, sizeof(MyTempletData_6)/sizeof(int));
			break;
		}
	case 9:
		{
			SetTempletParam(MyTempletData_7, sizeof(MyTempletData_7)/sizeof(int));
			break;
		}
	case 4:
		{
			SetTempletParam(MyTempletData_8, sizeof(MyTempletData_8)/sizeof(int));
			break;
		}
	case 10:
		{
			SetTempletParam(MyTempletData_9, sizeof(MyTempletData_9)/sizeof(int));
			break;
		}
	case 35:
		{
			SetTempletParam(MyTempletData_0, sizeof(MyTempletData_0)/sizeof(int));
			break;
		}
	case 36:
		{
			SetTempletParam(MyTempletData_10, sizeof(MyTempletData_10)/sizeof(int));
			break;
		}
	case 37:
		{
			SetTempletParam(MyTempletData_11, sizeof(MyTempletData_11)/sizeof(int));
			break;
		}
	case 38:
		{
			SetTempletParam(MyTempletData_12, sizeof(MyTempletData_12)/sizeof(int));
			break;
		}
	case 39:
		{
			SetTempletParam(MyTempletData_13, sizeof(MyTempletData_13)/sizeof(int));
			break;
		}
	case 40:
		{
			SetTempletParam(MyTempletData_14, sizeof(MyTempletData_14)/sizeof(int));
			break;
		}
	case 41:
		{
			SetTempletParam(MyTempletData_15, sizeof(MyTempletData_15)/sizeof(int));
			break;
		}
/*	case 9:
		{
			SetTempletParam(MyTempletData_9, sizeof(MyTempletData_9)/sizeof(int));
			break;
		}*/
	default:
		//ASSERT(FALSE);
		SetTempletParam(MyTempletData_4, sizeof(MyTempletData_4)/sizeof(int));
		break;
	}
}

void CTempletAALang::SetInitParam()
{
	// 控制面板区域
	m_rectControl.left=m_rectScreen.left;
	m_rectControl.right=m_rectScreen.Width()/5;
	m_rectControl.top=m_rectScreen.top;
	m_rectControl.bottom=m_rectScreen.Height()+m_rectScreen.top;

	// 空闲空间位置
	m_rectFree.left=m_rectScreen.left;
	m_rectFree.right=m_rectScreen.left+m_rectScreen.Width()/2;
	m_rectFree.top=m_rectScreen.top;
	m_rectFree.bottom=m_rectScreen.bottom;
}

void CTempletAALang::SetTempletParam(int* pData, int nLeng)
{
	ASSERT(nLeng % 5 == 0);
	ASSERT(nLeng > 5);

	int* pDataTmp = pData;
	m_bIsPictureInPicture = (((*(pDataTmp+4))&0xFF) != 0);
	int w = *(pDataTmp+2);
	int h = *(pDataTmp+3);
	
	// 控制面板区域
	m_rectControl.left=0;
	m_rectControl.right=0;
	m_rectControl.top=0;
	m_rectControl.bottom=0;


	// 空闲空间位置
	m_rectFree.left=0;
	m_rectFree.right=0;
	m_rectFree.top=0;
	m_rectFree.bottom=0;
	m_rectMidWindow = m_rectFree;

	m_nWindowNumber=nLeng/5-1;
	{
		for(int i = 0; i<3; i++)
		{
			m_nBigWindows[i] = -1;
		}
	}

	if((*(pDataTmp+4)) == 0x100)
	{
		pDataTmp += 5;

		for(int i = 5, j = 0;i<nLeng; i+=5, pDataTmp += 5, j++)
		{
			int iX = m_rectScreen.left;
			int iY = m_rectScreen.top;
			int iW = m_rectScreen.Width();
			int iH = m_rectScreen.Height();
			m_rectWindow[j].left = iX+iW*(*(pDataTmp+0))/w;
			m_rectWindow[j].top = iY+iH*(*(pDataTmp+1))/h;
			m_rectWindow[j].right = iX+iW*((*(pDataTmp+2))+(*(pDataTmp+0)))/w;
			m_rectWindow[j].bottom = iY+iH*((*(pDataTmp+3))+(*(pDataTmp+1)))/h;
			int tmp = iH*(*(pDataTmp+2))/w;
			m_rectWindow[j].top = iY+(iH-tmp)/2;
			m_rectWindow[j].bottom = m_rectWindow[j].top+tmp;
			if((*(pDataTmp+4)) != 0 && j<3)
			{
				m_nBigWindows[j] = j+1;
			}
		}
		return;
	}

	pDataTmp += 5;

	for(int i = 5, j = 0;i<nLeng; i+=5, pDataTmp += 5, j++)
	{
		int iX = m_rectScreen.left;
		int iY = m_rectScreen.top;
		int iW = m_rectScreen.Width();
		int iH = m_rectScreen.Height();
		m_rectWindow[j].left = iX+iW*(*(pDataTmp+0))/w;
		m_rectWindow[j].top = iY+iH*(*(pDataTmp+1))/h;
		m_rectWindow[j].right = iX+iW*((*(pDataTmp+2))+(*(pDataTmp+0)))/w;
		m_rectWindow[j].bottom = iY+iH*((*(pDataTmp+3))+(*(pDataTmp+1)))/h;
		if((*(pDataTmp+4)) != 0 && j<3)
		{
			m_nBigWindows[j] = j+1;
		}
	}
}

// 根据索引获得区域
bool CTempletAALang::GetWndRect(int index, LPRECT lpRect)
{
	if ((index>25) || (index>m_nWindowNumber))
		return false;

	*lpRect=m_rectWindow[index];
	return true;
}

// 获得剩余区域
RECT CTempletAALang::GetFreeRect()
{
	return m_rectFree;
}

// 获得中间窗口区域
RECT CTempletAALang::GetMidRect()
{
	return m_rectMidWindow;
}

// 获得控制面板区域
RECT CTempletAALang::GetControlRect()
{
	return m_rectControl;
}

// 窗口数
int	CTempletAALang::GetWindowCount()
{
	return m_nWindowNumber;
}

// 设置屏幕索引号,1.标准屏幕, 2.第二个屏幕
void CTempletAALang::SetScreenIndex(int nScreenIndex, RECT rcScreen)
{
	m_nScreenIndex = nScreenIndex;
	m_rectScreen = rcScreen;

}

// 获得全屏幕的尺寸
void	CTempletAALang::GetScreenRect(LPRECT lpRect)
{
	if (lpRect)
	{
		*lpRect	= m_rectScreen;
	}
}
// 获得屏幕索引号
int CTempletAALang::GetScreenIndex()
{
	return m_nScreenIndex;
}

void CTempletAALang::GetBigWindows(int iBigWindows[3])			//得到大窗口
{
	int i=0;for ( i=0;i<3;i++)
		iBigWindows[i]=m_nBigWindows[i];
}

void CTempletAALang::SetWindowSelected(byte iIndex,bool bSelect)
{
	if (iIndex >= 0 && iIndex < 25)
	{
		if (iIndex == 0)
		{
			int i = 0;
		}
		m_bSelected[iIndex] = bSelect;
	}
}

bool CTempletAALang::GetWindowSelected(byte iIndex)
{
	if (iIndex >= 0 && iIndex < 25)
	{
		if (iIndex == 0)
		{
			bool bb = m_bSelected[iIndex];
		}
		return m_bSelected[iIndex];
	}
	return false;
}